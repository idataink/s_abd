<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>农业监测预警大数据平台</title>
    <link rel="stylesheet" type="text/css" href="../css/iconfont.css">
    <link rel="stylesheet" type="text/css" href="../css/reset.css">
    <link rel="stylesheet" type="text/css" href="../css/common.css">
    <link rel="stylesheet" type="text/css" href="../css/credit-evaluation.css">
    <script type="text/javascript" src="../js/jquery-1.10.1.min.js"></script>
    <script type="text/javascript" src="../js/public.js"></script>
    <script src="../js/WdatePicker.js"></script>
    <script src="../js/echarts-all-3.js"></script>
    <script src="../js/echarts-engine.js"></script>
    <style type="text/css">
         #map{
            position: static;
            width: 100%;
            height: 750px;
            z-index: 0;
            border: none;    
           
            box-shadow: none;

          }
    </style>
</head>

<body>
    <div class="header">
    <h1><a href="###" class="logo"><img id="headerImg" src="../images/header-xy.png"></a></h1>
    <div class="headerR">
        <div class="headerR_r">
            <a href="navigation.html">返回导航页</a>
        </div>
        <!-- <ul class="headerR_l">
            <li class="headerR_lTime">
                <p>2016/11/11 星期五</p>
                <p class="headerR_lTimeDay"><span>七天预报</span></p>
            </li>
            <li>
                <p>晴</p>
                <p><i class="iconfont icon-zhaoshenbian02"></i></p>
            </li>
            <li>
                <p>4-7</p>
                <p>℃</p>
            </li>
            <li>
                <p>94</p>
                <p>AQI</p>
            </li>
            <li>
                <p>61</p>
                <p><i class="iconfont icon-shape6"></i></p>
            </li>
            <li>
                <p>2级</p>
                <p><i class="iconfont icon-changhongchuifeng"></i></p>
            </li>
        </ul> -->
    </div>
</div>

 <div class="leftBar">
    <ul>
        <li onclick="argiObj.link('credit-evaluation.html')" style="padding-top: 5px;" class="active">
            <i class="iconfont icon-zhuye"></i>
            <p>企业信用一张图</p>
        </li>
        <li onclick="argiObj.link('subdivision-field.html')">
            <i class="iconfont icon-qitalingyu2"></i>
            <p>细分领域信用</p>
        </li>
        <li onclick="argiObj.link('regional-enterprise.html')">
            <i class="iconfont icon-loudong"></i>
            <p>区域企业信用</p>
        </li>
        <li onclick="argiObj.link('decide-alarm.html')">
            <i class="iconfont icon-yujing-copy"></i>
            <p>决策预警</p>
        </li>

    </ul>
</div>


<script type="text/javascript">
    $(function(){
        var localUrl = window.location + '';
        var spIndex;
        if (localUrl.indexOf('/credit-evaluation') >= 0) { //企业信用一张图
            spIndex = 0;
        } else if (localUrl.indexOf('/subdivision-field') >= 0) { //细分领域信用
            spIndex = 1;
        } else if (localUrl.indexOf('/regional-enterprise') >= 0) {
            spIndex = 2;
        } else if (localUrl.indexOf('/decide-alarm') >= 0) {
            spIndex = 3;
        }
        $(".leftBar ul li").eq(spIndex).addClass("active").siblings().removeClass("active");
    })
</script>
    <div class="credit-content">
        <div class="credit-box clearfix">
            <div class="credit-module col4">
                <div class="moduleCont">
                    <div class="titleLeft">
                        <dl>
                            <dt><i class="iconfont icon-ding"></i></dt>
                            <dd>
                                <p>优秀信用企业</p>
                                <p><em>1276</em></p>
                            </dd>
                        </dl>
                    </div>
                    <div class="titleRight">A级</div>
                </div>
            </div>
            <div class="credit-module col4">
                <div class="moduleCont">
                    <div class="titleLeft">
                        <dl>
                            <dt><i class="iconfont icon-duigou lh"></i></dt>
                            <dd>
                                <p>良好信用企业</p>
                                <p><em class="lh">2087</em></p>
                            </dd>
                        </dl>
                    </div>
                    <div class="titleRight">B级</div>
                </div>
            </div>
            <div class="credit-module col4">
                <div class="moduleCont">
                    <div class="titleLeft">
                        <dl>
                            <dt><i class="iconfont icon-cai xy"></i></dt>
                            <dd>
                                <p>信用不良企业</p>
                                <p><em class="xy">1045</em></p>
                            </dd>
                        </dl>
                    </div>
                    <div class="titleRight">C级</div>
                </div>
            </div>
            <div class="credit-module col4">
                <div class="moduleCont">
                    <div class="titleLeft">
                        <dl>
                            <dt><i class="iconfont icon-icon116 gw"></i></dt>
                            <dd>
                                <p>信用高危企业</p>
                                <p><em class="gw">1367</em></p>
                            </dd>
                        </dl>
                    </div>
                    <div class="titleRight">D级</div>
                </div>
            </div>
        </div>
        <div class="credit-box">
            <div class="credit-module wid100">
                <div class="moduleCont ceModule1H85">
                    <div class="inSel">
                        地区：
                        <div class="simSel">
                            <span>济宁市</span><i></i>
                            <ul class="simSelHide">
                                <li class="mapChina">济宁市</li>
                                <li class="mapShandong">青岛市</li>
                            </ul>
                        </div>
                        行业：
                        <div class="simSel">
                            <span>全部行业</span><i></i>
                            <ul class="simSelHide">
                                <li class="mapChina">畜牧业</li>
                                <li class="mapShandong">农业</li>
                                <li class="">...</li>
                            </ul>
                        </div>
                        时间：
                        <div class="simSel simSelTime">
                            <input id="DatePicker1" onclick="WdatePicker({el:'DatePicker1',highLineWeekDay:false,dateFmt:'yyyy-MM',qsEnabled:false,autoShowQS:false,isShowClear:false,isShowToday:false})" type="text" class="p_myDatePicker" value="2016-12" readonly/><i></i></div>
                        <div id="reenCx" class="searchBtn">
                            查询
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="credit-box">
            <div class="credit-module left widLeft">
                <div class="moduleCont">
                    <div class="ceModule1H400 innerTab">
                        <table>
                            <tr>
                                <th>风险区域</th>
                                <th>评级</th>
                                <th>数量</th>
                                <th>占比</th>
                                <th>风险评级的含义</th>
                            </tr>
                            <tr>
                                <td>低风险区域</td>
                                <td>AAA</td>
                                <td>559</td>
                                <td>10%</td>
                                <td>无风险</td>
                            </tr>
                            <tr>
                                <td></td>
                                <td>AA</td>
                                <td>748</td>
                                <td>13%</td>
                                <td>风险很低</td>
                            </tr>
                            <tr>
                                <td></td>
                                <td>A</td>
                                <td>623</td>
                                <td>11%</td>
                                <td>风险低</td>
                            </tr>
                            <tr>
                                <td>中风险区域</td>
                                <td>BBB</td>
                                <td>620</td>
                                <td>11%</td>
                                <td>风险较低</td>
                            </tr>
                            <tr>
                                <td></td>
                                <td>BB</td>
                                <td>443</td>
                                <td>8%</td>
                                <td>风险一般</td>
                            </tr>
                            <tr>
                                <td></td>
                                <td>B</td>
                                <td>525</td>
                                <td>9%</td>
                                <td>存在风险</td>
                            </tr>
                            <tr>
                                <td>高风险区域</td>
                                <td>CCC</td>
                                <td>522</td>
                                <td>9%</td>
                                <td>风险比较高</td>
                            </tr>
                            <tr>
                                <td></td>
                                <td>CC</td>
                                <td>816</td>
                                <td>14%</td>
                                <td>风险稍高</td>
                            </tr>
                            <tr>
                                <td></td>
                                <td>C</td>
                                <td>488</td>
                                <td>8%</td>
                                <td>风险高</td>
                            </tr>
                            <tr>
                                <td></td>
                                <td>D</td>
                                <td>431</td>
                                <td>7%</td>
                                <td>风险很高</td>
                            </tr>
                            
                            <tr>
                                <td>合计</td>
                                <td colspan="4">共5775家企业</td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
            <div class="right widRight">
                <div class="credit-module wid100" style="margin-bottom: 22px;">
                    <div class="moduleTit overflow-hidden">区域信用指数</div>
                    <div class="moduleCont">
                        <div class="ceModule1H125 d3-dashboard"></div>
                    </div>
                </div>

                <div class="credit-module wid100 marginB0">
                    <div class="moduleTit overflow-hidden">区域信用评分模型</div>
                    <div class="moduleCont">
                        <div class="ceModule1H190" id="grade-model"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="credit-box">
            <div class="left widLeft">
                <div class="moduleCont" style="position: relative;">
                    <ul class="visualMap_2">
                        <li><i class="bg1"></i>A级企业</li>
                        <li><i class="bg2"></i>B级企业</li>
                        <li><i class="bg3"></i>C级企业</li>
                        <li><i class="bg4"></i>D级企业</li>                          
                    </ul>
                    <div class="ceModule1H720" id="map">
                        可视化图
                    </div>
                </div>
            </div>
            <div class="right widRight">
                <div class="credit-module wid100" style="margin-bottom: 22px;">
                    <div class="moduleTit overflow-hidden">排行榜（区域排行）</div>
                    <div class="moduleCont">
                        <div class="ceModule1H353 innerTab">
                            <table>
                            <tr>
                                <th>排名</th>
                                <th>区域</th>
                                <th>等级</th>
                                <th>数量</th>
                            </tr>
                            <tr>
                                <td>1</td>
                                <td>金乡县</td>
                                <td>AAA</td>
                                <td>5</td>
                            </tr>
                            <tr>
                                <td>2</td>
                                <td>鱼台县</td>
                                <td>AAA</td>
                                <td>5</td>
                            </tr>
                            <tr>
                                <td>3</td>
                                <td>微山县</td>
                                <td>AAA</td>
                                <td>5</td>
                            </tr>
                            <tr>
                                <td>4</td>
                                <td>高新区</td>
                                <td>AA</td>
                                <td>4</td>
                            </tr>
                            <tr>
                                <td>5</td>
                                <td>任城区</td>
                                <td>AA</td>
                                <td>4</td>
                            </tr>
                            <tr>
                                <td>6</td>
                                <td>嘉祥县</td>
                                <td>A</td>
                                <td>3</td>
                            </tr>
                            <tr>
                                <td>7</td>
                                <td>泗水县</td>
                                <td>A</td>
                                <td>3</td>
                            </tr>
                            <tr>
                                <td>8</td>
                                <td>太白湖区</td>
                                <td>A</td>
                                <td>3</td>
                            </tr>
                            <tr>
                                <td>9</td>
                                <td>济宁高新区</td>
                                <td>B</td>
                                <td>2</td>
                            </tr>
                            <tr>
                                <td>10</td>
                                <td>汾上县</td>
                                <td>B</td>
                                <td>2</td>
                            </tr>

                        </table>
                        </div>
                    </div>
                </div>

                <div class="credit-module wid100 marginB0">
                    <div class="moduleTit overflow-hidden">任城区</div>
                    <div class="moduleCont">
                        <div class="ceModule1H268" id="renchengqu"></div>
                        <div class="rencheng-legend">
                            <h4>
                                <span>企业总数：</span>
                                <span id="qyzs">1155</span>
                                <span>家</span>
                            </h4>
                            <div id="dsjqy">
                                <div class="rencheng-row">
                                    <div>
                                        <span>A级企业：</span>
                                        <span>126家</span>
                                    </div>
                                    <div>
                                        <span>B级企业：</span>
                                        <span>243家</span>
                                    </div>
                                </div>
                                <div class="rencheng-row">
                                    <div>
                                        <span>C级企业：</span>
                                        <span>403家</span>
                                    </div>
                                    <div>
                                        <span>D级企业：</span>
                                        <span>377家</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="../js/d3.v4.min.js"></script>
    <script src="../js/commonLibMap.min.js"></script>
    <script src="../js/d3.min.js"></script>
    <script src="../js/d3-charts.min.js"></script>
    <script src="../js/regional-enterprise.js"></script>
    <script type="text/javascript">
    $(function() {
        var winH = $(window).height();
        if (winH <= 670) {
            $("body").height(590);
        } else {
            $("body").height(winH - 80);
        }

        $(".jcyj dt p").on("click", function() {
            $(this).addClass("active").siblings().removeClass("active");
            var index = $(this).index();
            console.log(index)
            $(".jcyj dl dd").eq(index).show().siblings('dd').hide();
        })
    })
    var ceModule3Cont = charts.init({
        id: 820,
        container: "ceModule3Cont",
        option: {}
    });
    var ceModule4Cont = charts.init({
        id: 825,
        container: "ceModule4Cont",
        option: {}
    });
    var ceModule5Cont = charts.init({
        id: 824,
        container: "ceModule5Cont",
        option: {}
    });

    // echarts表
    charts.init({id:836,container:"grade-model",option:{
         series: [
            {             
              data: [
                {
                  value: [86, 69, 66, 62, 72, 73],
                  name: '全部'
                }
              ]
            }
      ]

        }});
    charts.init({id:835,container:"renchengqu",option:{
        series : [
        {
            
            data:[
                {
                    value:126, 
                    name:'A级企业'
                },
                {
                    value:243, 
                    name:'B级企业'
                },
                {
                    value:403, 
                    name:'C级企业'
                },
                {
                    value:377, 
                    name:'D级企业'                
                }
             
            ]
            
        }
    ]
    }});


    var dashboard = d3Charts.chart()
    // 背景设置
        .width('100%')
        .height(115)
        .backgroundColor('100%')
        // 中心数值文字设置
        .centerTextValue(85)
        .centerTextValueColor('yellow')
        .centerTextValueFontSize(40)
        // 中心箭头线设置
        // 中心文本文字设置
        .centerTextTitle('优')
        .centerTextTitleColor('yellow')
        .centerTextTitleFontSize(30)
        .centerArrowLineX1(75)
        .centerArrowLineX2(75)
        // 内轨轨道设置
        .orbitColorIn('#ccc')
        .scaleColor('#4b6692')

    d3.select('.d3-dashboard').call(dashboard);






/*可视化地图接入*/

    var data = {
  // 点的数据


  
  // 柱状图数据
  bar: [{
    fillColor: ['#54fc33', '#0a66ff', '#ffde00', '#dc2209'],
    strokeColor: ['#52d278', '#128ef5', '#c7c431', '#c76349'],
    pos: [116.111498,35.81181],
      data: [
          {
              value: 3,
              name: 'A级企业'
          },
          {
              value: 5,
              name: 'B级企业'
          },
          {
              value: 1,
              name: 'C级企业'
          },
          {
              value: 8,
              name: 'D级企业'
          }
      ],
      range: [0, 100]
  }, {
    fillColor: ['#54fc33', '#0a66ff', '#ffde00', '#dc2209'],
    strokeColor: ['#52d278', '#128ef5', '#c7c431', '#c76349'],
    pos: [116.488068,35.739422],
      data: [
          {
              value: 2,
              name: 'A级企业'
          },
          {
              value: 5,
              name: 'B级企业'
          },
          {
              value: 1,
              name: 'C级企业'
          },
          {
              value: 3,
              name: 'D级企业'
          }
      ],
    range: [0, 100]
  }, {
    fillColor: ['#54fc33', '#0a66ff', '#ffde00', '#dc2209'],
    strokeColor: ['#52d278', '#128ef5', '#c7c431', '#c76349'],
    pos: [116.627053,35.023133],
      data: [
          {
              value: 3,
              name: 'A级企业'
          },
          {
              value: 1,
              name: 'B级企业'
          },
          {
              value: 2,
              name: 'C级企业'
          },
          {
              value: 7,
              name: 'D级企业'
          }
      ],
    range: [0, 100]
  }, {
    fillColor: ['#54fc33', '#0a66ff', '#ffde00', '#dc2209'],
    strokeColor: ['#52d278', '#128ef5', '#c7c431', '#c76349'],
    pos: [117.001898,35.269171],
      data: [
          {
              value: 3,
              name: 'A级企业'
          },
          {
              value: 1,
              name: 'B级企业'
          },
          {
              value: 2,
              name: 'C级企业'
          },
          {
              value: 7,
              name: 'D级企业'
          }
      ],
    range: [0, 100]
  }]
};

// 点击事件
function clickHandle(event, data, cmap) {
  if (data._type == 'area') {
    var level = cmap.option.level + 1;
    showMap(data.properties.name, level);
  }

}
// 鼠标触摸事件
function mouseOverHandle(event, data) {  

/*  if (data._type == 'bar') {
    var rect = event.target.getBoundingClientRect();
    var $tip = $('#map_popOver');
    if (!$tip.length) {
      $tip = $('<div id="map_popOver">');
      $('#map').append($tip);
    }
    $tip.html(popOver(data));
    var offset = $('#map svg').offset();
    $tip.css({
      left: (rect.right - rect.width / 2 - offset.left + window.scrollX) + 'px',
      top: (rect.bottom - rect.height / 2 - offset.top + window.scrollY) + 'px',
      display: 'block'
    });
  } */
}

// 鼠标离开事件
function mouseOutHandle(event, data) {
  if (!$(event.toElement).is('#map_popOver')) {
    $('#map_popOver').css({
      display: 'none'
    });
  }
  if (!$(event.toElement).is('#map_tooltip')) {
    d3.select("#map_tooltip").transition().duration(500).style("opacity", 0);
  }
}

// 返回tooltip的内容
function tooltipHtml(n) {
  return "<h4>当前位置</h4><table>" +
    "<tr><td>" + n + "</td></tr>" +
    "</table>";
}

// 返回popOver内容
function popOver(param) {
 
  return '<h4>' + (param.title) + '</h4>' +
    '<p><span class="import">' + (param.core) + '</span><span>信用评分</span></p>' +
    '<p><span class="star">' + star + '</span><span>信用等级</span></p>'
}

// 设定GeoJson基础路径
commonLib.CMap.config.baseDir = '/geoJson/';

// 绘制地图方法
function showMap(name, level) {
  var map = new commonLib.CMap({
    dom: document.getElementById('map'),
    data: data,
    mouseOutHandle: mouseOutHandle,
    mouseOverHandle: mouseOverHandle,
    clickHandle: level <= 2 ? clickHandle : null,
    name: name,
    // areaColor: function(d) {
    //   console.log(d);
    //   return '#f00'
    // },
    level: level == undefined ? 1 : level
  });
  return map;
}

var cmap = showMap('济宁市', 3);

$('#btn').on('click', function() {
  cmap.data = {
    points: [{
      "name": "sss",
      "log": "114.3",
      "lat": "38.9",
      "icon": {
        url: 'imgs/icon_1.png',
        width: 50,
        height: 50
      }
    }, {
      "name": "XXX",
      "log": "123",
      "lat": "42.2",
      "icon": {
        url: 'imgs/icon_2.png',
        width: 50,
        height: 50
      }
    }, ]
  }
})

/*可视化地图接入 END*/

    </script>
</body>

</html>
